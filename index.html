        <!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a472a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Golf Barcelona - Control de Tiempos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1a472a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        header {
            text-align: center;
            color: white;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-text h1 { font-size: 2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header-text p { opacity: 0.9; }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            color: white;
            transition: all 0.3s;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active { background: white; color: #1a472a; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) { .main-content { grid-template-columns: 1fr; } }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .panel h2 {
            color: #1a472a;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
            font-size: 1.2rem;
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; color: #333; font-weight: 600; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #2d5a3d; }

        .tee-selector, .type-selector { display: flex; gap: 10px; }

        .tee-option, .type-option {
            flex: 1;
            padding: 12px;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            transition: all 0.3s;
        }

        .tee-option:hover, .type-option:hover { border-color: #2d5a3d; }
        .tee-option.active { border-color: #2d5a3d; background: #e8f5e9; }
        .tee-option .tee-number { font-size: 1.5rem; font-weight: bold; color: #1a472a; }
        .tee-option .tee-label { font-size: 0.8rem; color: #666; }

        .type-option.active.normal { border-color: #2d5a3d; background: #e8f5e9; }
        .type-option.active.tournament { border-color: #1976d2; background: #e3f2fd; }
        .type-option.active.greenmonday { border-color: #4caf50; background: #e8f5e9; }
        .type-option.active.watch { border-color: #ff9800; background: #fff3e0; }

        .type-option .type-icon { font-size: 1.3rem; }
        .type-option .type-label { font-size: 0.75rem; color: #666; font-weight: 600; margin-top: 3px; }

        .holes-selector { display: flex; gap: 10px; margin-top: 10px; }

        .holes-option {
            flex: 1;
            padding: 10px;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            transition: all 0.3s;
        }

        .holes-option:hover { border-color: #9c27b0; }
        .holes-option.active { border-color: #9c27b0; background: #f3e5f5; }
        .holes-option .holes-number { font-size: 1.4rem; font-weight: bold; color: #7b1fa2; }
        .holes-option .holes-label { font-size: 0.75rem; color: #666; }

        .group-config { background: #f8f9fa; border-radius: 10px; padding: 12px; }

        .config-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 2px solid #e8f5e9;
        }

        .config-row.has-value { border-color: #2d5a3d; background: #f0fff4; }
        .config-label { display: flex; align-items: center; gap: 8px; }
        .config-icon { font-size: 1.3rem; }
        .config-text { font-weight: 600; color: #333; font-size: 0.9rem; }
        .config-subtext { font-size: 0.7rem; color: #888; }
        .quantity-selector { display: flex; align-items: center; gap: 6px; }

        .qty-btn {
            width: 32px;
            height: 32px;
            border: 2px solid #2d5a3d;
            background: white;
            color: #2d5a3d;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover { background: #2d5a3d; color: white; }
        .qty-value { width: 30px; text-align: center; font-size: 1.2rem; font-weight: bold; color: #1a472a; }
        .qty-value.zero { color: #ccc; }

        .group-summary {
            margin-top: 10px;
            padding: 10px;
            background: linear-gradient(135deg, #1a472a, #2d5a3d);
            border-radius: 8px;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        .color-picker { display: flex; gap: 6px; flex-wrap: wrap; }

        .color-option {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: #333; }

        .group-markers { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }

        .marker-box {
            flex: 1;
            min-width: 80px;
            padding: 10px 8px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .marker-box.tournament { background: #e3f2fd; border: 2px solid #1976d2; color: #1565c0; }
        .marker-box.tournament.active { background: #1976d2; color: white; }
        .marker-box.greenmonday { background: #e8f5e9; border: 2px solid #4caf50; color: #2e7d32; }
        .marker-box.greenmonday.active { background: #4caf50; color: white; }
        .marker-box.watch { background: #fff3e0; border: 2px solid #ff9800; color: #e65100; }
        .marker-box.watch.active { background: #ff9800; color: white; }

        .marker-icon { font-size: 1.3rem; }
        .marker-text { font-size: 0.7rem; font-weight: 600; margin-top: 3px; }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary { background: linear-gradient(135deg, #2d5a3d, #1a472a); color: white; }
        .btn-primary:hover { box-shadow: 0 5px 20px rgba(45, 90, 61, 0.4); }
        .btn-danger { background: #dc3545; color: white; margin-top: 10px; }
        .btn-secondary { background: #e0e0e0; color: #333; }
        .btn-info { background: #17a2b8; color: white; }

        .players-list { margin-top: 20px; max-height: 350px; overflow-y: auto; }

        .player-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #2d5a3d;
            position: relative;
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
        }

        .player-card:hover { box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .player-card.dragging { opacity: 0.5; }
        .player-card.drag-over { border-top: 3px solid #1976d2; margin-top: 10px; }

        .player-card.delayed { border-left-color: #dc3545; background: #fff5f5; }
        .player-card.watch-group { border-left-color: #ff9800; background: #fff8e1; }
        .player-card.tournament-group { border-left-color: #1976d2; background: #e3f2fd; }
        .player-card.greenmonday-group { border-left-color: #4caf50; background: #e8f5e9; }
        .player-card.skipped-group { border-left-color: #9c27b0; background: #f3e5f5; }
        .player-card.has-notes { border-left-color: #ff5722; }

        .player-header { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; margin-bottom: 5px; }

        .player-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .player-name { font-weight: 600; color: #333; flex: 1; }

        .badge { padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; color: white; }
        .badge.tournament { background: #1976d2; }
        .badge.greenmonday { background: #4caf50; }
        .badge.watch { background: #ff9800; }
        .badge.nine-holes { background: #9c27b0; }
        .badge.skipped { background: #9c27b0; }
        .badge.has-notes { background: #ff5722; }

        .player-info { font-size: 0.8rem; color: #666; margin-bottom: 3px; }
        .player-details { font-size: 0.75rem; color: #888; background: #f0f0f0; padding: 4px 8px; border-radius: 4px; }

        .player-notes {
            margin-top: 8px;
            padding: 8px 10px;
            background: #fff3e0;
            border-radius: 6px;
            border-left: 3px solid #ff5722;
            font-size: 0.8rem;
            color: #e65100;
        }

        .player-notes-title {
            font-weight: 600;
            font-size: 0.7rem;
            color: #bf360c;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .player-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .expected-hole { font-size: 1.4rem; font-weight: bold; color: #1a472a; }

        .player-status { padding: 3px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
        .status-ontime { background: #e8f5e9; color: #2d5a3d; }
        .status-delayed { background: #ffebee; color: #c62828; }
        .status-ahead { background: #e3f2fd; color: #1565c0; }

        .player-actions { position: absolute; top: 8px; right: 8px; display: flex; gap: 5px; }

        .action-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1rem;
            padding: 2px 5px;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .action-btn:hover { background: #e0e0e0; color: #333; }

        .no-players { text-align: center; color: #999; padding: 20px; font-style: italic; }

        /* ===== MODAL ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 450px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e8f5e9; }
        .modal-header h3 { color: #1a472a; font-size: 1.3rem; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; }

        .current-hole-display { background: linear-gradient(135deg, #1a472a, #2d5a3d); color: white; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px; }
        .current-hole-display .label { font-size: 0.85rem; opacity: 0.9; }
        .current-hole-display .value { font-size: 2rem; font-weight: bold; }

        .color-picker-modal { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .color-picker-modal .color-option { width: 35px; height: 35px; }

        .skip-info { background: #f3e5f5; border: 2px solid #9c27b0; border-radius: 10px; padding: 12px; margin-top: 15px; }
        .skip-info-title { font-weight: 600; color: #7b1fa2; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .skip-info-text { font-size: 0.85rem; color: #666; }

        .btn-skip { background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; }

        .modal-actions { display: flex; gap: 10px; margin-top: 25px; }
        .modal-actions .btn { flex: 1; }

        /* ===== NOTAS SECTION ===== */
        .notes-section {
            background: #fff8e1;
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
        }

        .notes-section-title {
            font-weight: 600;
            color: #e65100;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .quick-notes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .quick-note-btn {
            padding: 6px 10px;
            border: 2px solid #ffcc80;
            background: white;
            border-radius: 20px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #e65100;
        }

        .quick-note-btn:hover {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
        }

        .quick-note-btn.warning {
            border-color: #ffab40;
            background: #fff3e0;
        }

        .quick-note-btn.danger {
            border-color: #ff5722;
            background: #fbe9e7;
            color: #d84315;
        }

        .quick-note-btn.danger:hover {
            background: #ff5722;
            color: white;
        }

        .quick-note-btn.success {
            border-color: #4caf50;
            background: #e8f5e9;
            color: #2e7d32;
        }

        .quick-note-btn.success:hover {
            background: #4caf50;
            color: white;
        }

        .notes-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 2px solid #ffcc80;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            font-family: inherit;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #ff9800;
        }

        .notes-history {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .note-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.8rem;
            border-left: 3px solid #ff9800;
        }

        .note-item .note-time {
            font-size: 0.7rem;
            color: #999;
            white-space: nowrap;
        }

        .note-item .note-text {
            flex: 1;
            color: #333;
        }

        .note-item .note-delete {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0;
        }

        .note-item .note-delete:hover {
            color: #dc3545;
        }

        .clear-notes-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 0.75rem;
            cursor: pointer;
            margin-top: 5px;
        }

        .clear-notes-btn:hover {
            color: #dc3545;
            text-decoration: underline;
        }

        /* ===== CAMPO DE GOLF ===== */
        .golf-course { background: linear-gradient(180deg, #7cb342 0%, #558b2f 100%); border-radius: 15px; padding: 15px; }
        .course-title { text-align: center; color: white; font-size: 1.1rem; margin-bottom: 15px; }
        .holes-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .nine-section-visual { display: flex; flex-direction: column; gap: 6px; }
        .nine-section-visual.back-nine { flex-direction: column-reverse; }
        .nine-title { color: white; text-align: center; font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; }

        .hole { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.15); padding: 8px 12px; border-radius: 20px; }
        .hole.current { background: rgba(255,255,255,0.95); transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .hole.watch-hole { background: rgba(255, 152, 0, 0.85); }
        .hole.tournament-hole { background: rgba(25, 118, 210, 0.85); }
        .hole.greenmonday-hole { background: rgba(76, 175, 80, 0.85); }
        .hole.skipped-hole { background: rgba(156, 39, 176, 0.85); }

        .hole-number { width: 28px; height: 28px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #1a472a; font-size: 0.85rem; }
        .hole.current .hole-number { background: #1a472a; color: white; }
        .hole.watch-hole .hole-number { background: #e65100; color: white; }
        .hole.tournament-hole .hole-number { background: #0d47a1; color: white; }
        .hole.greenmonday-hole .hole-number { background: #2e7d32; color: white; }
        .hole.skipped-hole .hole-number { background: #7b1fa2; color: white; }

        .hole-info { flex: 1; color: white; font-size: 0.75rem; }
        .hole.current .hole-info { color: #1a472a; }

        .player-markers { display: flex; gap: 2px; }
        .player-dot { width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }

        .clock-display { text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-top: 15px; }
        .clock-display .time { font-size: 2.5rem; font-weight: bold; color: white; }
        .clock-display .date { color: rgba(255,255,255,0.8); font-size: 0.9rem; }

        .legend { display: flex; justify-content: center; gap: 8px; margin-top: 15px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 5px; color: white; font-size: 0.75rem; background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 12px; }
        .legend-item.watch { background: rgba(255, 152, 0, 0.7); }
        .legend-item.tournament { background: rgba(25, 118, 210, 0.7); }
        .legend-item.greenmonday { background: rgba(76, 175, 80, 0.7); }
        .legend-item.skipped { background: rgba(156, 39, 176, 0.7); }
        .legend-item.has-notes { background: rgba(255, 87, 34, 0.7); }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; border: 2px solid white; }

        .summary-stats { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-top: 15px; }
        @media (max-width: 700px) { .summary-stats { grid-template-columns: repeat(3, 1fr); } }

        .stat-card { background: rgba(0,0,0,0.2); padding: 10px 5px; border-radius: 8px; text-align: center; color: white; }
        .stat-card.warning { background: rgba(255, 152, 0, 0.6); }
        .stat-card.tournament { background: rgba(25, 118, 210, 0.6); }
        .stat-card.greenmonday { background: rgba(76, 175, 80, 0.6); }
        .stat-card .stat-value { font-size: 1.3rem; font-weight: bold; }
        .stat-card .stat-label { font-size: 0.6rem; }

        .current-time-info { background: #f0f4f0; border-radius: 8px; padding: 10px; margin-bottom: 15px; text-align: center; }
        .current-time-info .value { font-size: 1.2rem; font-weight: bold; color: #1a472a; }
        .current-time-info .label { font-size: 0.8rem; color: #666; }

        /* ===== SALIDAS PANEL ===== */
        .salidas-panel { max-width: 1000px; margin: 0 auto; }

        .salidas-header { text-align: center; margin-bottom: 25px; }
        .salidas-icon { font-size: 3rem; margin-bottom: 10px; }
        .salidas-title { font-size: 1.8rem; color: #1a472a; font-weight: bold; }
        .salidas-subtitle { color: #666; }

        .paste-area {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 3px dashed #2d5a3d;
            border-radius: 12px;
            font-family: monospace;
            font-size: 0.9rem;
            resize: vertical;
            background: #f8fff8;
        }

        .paste-area:focus { border-style: solid; background: white; }

        .paste-help {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .paste-help-title { font-weight: 600; color: #1565c0; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .paste-help-text { font-size: 0.85rem; color: #666; line-height: 1.6; }
        .paste-help code { background: #e0e0e0; padding: 2px 6px; border-radius: 4px; font-family: monospace; }

        .import-options { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        @media (max-width: 600px) { .import-options { grid-template-columns: 1fr; } }

        .option-box { background: #f8f9fa; border-radius: 12px; padding: 15px; }
        .option-box h4 { color: #1a472a; margin-bottom: 12px; font-size: 0.95rem; }

        .preview-section { margin-top: 25px; }
        .preview-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .preview-title h3 { color: #1a472a; }
        .preview-count { background: #1a472a; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; }

        .preview-list { max-height: 300px; overflow-y: auto; background: #f8f9fa; border-radius: 12px; padding: 10px; }

        .preview-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #2d5a3d;
        }

        .preview-item.tournament { border-left-color: #1976d2; background: #e3f2fd; }
        .preview-item.greenmonday { border-left-color: #4caf50; background: #e8f5e9; }
        .preview-item.watch { border-left-color: #ff9800; background: #fff8e1; }

        .preview-time { font-weight: bold; color: #1a472a; min-width: 60px; }
        .preview-name { flex: 1; }
        .preview-players { background: #e0e0e0; padding: 3px 10px; border-radius: 12px; font-size: 0.8rem; }

        .preview-remove {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .preview-remove:hover { color: #dc3545; }

        .import-actions { display: flex; gap: 15px; margin-top: 20px; }
        .import-actions .btn { flex: 1; padding: 15px; font-size: 1.1rem; }

        .no-preview { text-align: center; padding: 40px; color: #999; }
        .no-preview-icon { font-size: 3rem; margin-bottom: 10px; opacity: 0.5; }

        /* ===== CONFIG & RULES ===== */
        .config-panel, .rules-panel { max-width: 900px; margin: 0 auto; }

        .config-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
        .total-time-box { background: linear-gradient(135deg, #1a472a, #2d5a3d); color: white; padding: 15px 25px; border-radius: 12px; text-align: center; }
        .total-time-box .value { font-size: 1.5rem; font-weight: bold; }

        .preset-buttons { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
        .preset-btn { padding: 10px 15px; border: 2px solid #2d5a3d; border-radius: 8px; background: white; color: #2d5a3d; font-weight: 600; cursor: pointer; }
        .preset-btn:hover { background: #2d5a3d; color: white; }

        .times-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        @media (max-width: 600px) { .times-grid { grid-template-columns: 1fr; } }

        .nine-section { background: #f8f9fa; border-radius: 12px; padding: 15px; }
        .nine-section h3 { color: #1a472a; margin-bottom: 12px; text-align: center; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; font-size: 1rem; }

        .hole-time-row { display: flex; align-items: center; gap: 10px; padding: 8px 10px; background: white; border-radius: 8px; margin-bottom: 6px; }
        .hole-badge { width: 30px; height: 30px; background: linear-gradient(135deg, #1a472a, #2d5a3d); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.85rem; }
        .hole-details { flex: 1; }
        .hole-details .par-info { font-weight: 600; color: #333; font-size: 0.85rem; }
        .hole-details .meters-info { font-size: 0.7rem; color: #888; }
        .time-input-wrapper { display: flex; align-items: center; gap: 4px; }
        .time-input-wrapper input { width: 50px; padding: 8px; border: 2px solid #e0e0e0; border-radius: 6px; text-align: center; font-size: 1rem; font-weight: 600; color: #1a472a; }
        .nine-subtotal { margin-top: 12px; padding: 10px; background: #e8f5e9; border-radius: 8px; text-align: center; font-weight: 600; color: #1a472a; }
        .save-config-btn { width: 100%; padding: 15px; background: linear-gradient(135deg, #2d5a3d, #1a472a); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-top: 20px; }

        /* ===== MARSHALL ===== */
        .marshall-header { text-align: center; margin-bottom: 25px; }
        .marshall-icon { font-size: 4rem; margin-bottom: 10px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .marshall-title { font-size: 2rem; color: #1a472a; font-weight: bold; text-transform: uppercase; letter-spacing: 3px; }
        .marshall-subtitle { color: #666; }

        .notebook { background: #fffef0; border-radius: 15px; box-shadow: 0 0 0 2px #8b4513, 0 0 0 4px #654321, 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .notebook-binding { position: absolute; left: 30px; top: 0; bottom: 0; width: 4px; background: linear-gradient(to bottom, #dc3545 0%, #dc3545 10%, transparent 10%, transparent 20%, #dc3545 20%, #dc3545 30%, transparent 30%, transparent 40%, #dc3545 40%, #dc3545 50%, transparent 50%, transparent 60%, #dc3545 60%, #dc3545 70%, transparent 70%, transparent 80%, #dc3545 80%, #dc3545 90%, transparent 90%, transparent 100%); }
        .notebook-header { background: linear-gradient(135deg, #1a472a, #2d5a3d); color: white; padding: 20px 20px 20px 50px; display: flex; align-items: center; gap: 15px; }
        .notebook-header-icon { font-size: 2rem; }
        .notebook-header-text h3 { font-size: 1.3rem; margin-bottom: 3px; }
        .notebook-header-text p { font-size: 0.85rem; opacity: 0.9; }
        .notebook-content { padding: 25px 25px 25px 50px; background: repeating-linear-gradient(transparent, transparent 27px, #e0e0e0 27px, #e0e0e0 28px); min-height: 300px; }
        .rule-section { margin-bottom: 25px; }
        .rule-section-title { display: flex; align-items: center; gap: 10px; font-size: 1.1rem; font-weight: bold; color: #1a472a; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px dashed #2d5a3d; }
        .rule-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 10px; padding: 8px 12px; background: rgba(255,255,255,0.7); border-radius: 8px; border-left: 3px solid #2d5a3d; line-height: 1.6; }
        .rule-number { background: #1a472a; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; flex-shrink: 0; }
        .rule-text { color: #333; font-size: 0.9rem; }
        .rule-text strong { color: #1a472a; }
        .rule-highlight { background: #fff3cd; border-left-color: #ff9800; }
        .rule-important { background: #ffebee; border-left-color: #dc3545; }

        .notebook-footer { background: linear-gradient(135deg, #1a472a, #2d5a3d); padding: 20px 25px 20px 50px; }
        .contact-section { display: flex; flex-direction: column; gap: 12px; }
        .contact-item { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.15); padding: 12px 15px; border-radius: 10px; flex-wrap: wrap; gap: 10px; }
        .contact-info-left { display: flex; align-items: center; gap: 12px; }
        .contact-icon { font-size: 1.5rem; }
        .contact-details { color: white; }
        .contact-details .contact-label { font-size: 0.75rem; opacity: 0.8; }
        .contact-details .contact-value { font-size: 1rem; font-weight: 600; }
        .contact-btn { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 20px; border-radius: 25px; font-weight: 600; font-size: 0.9rem; text-decoration: none; transition: all 0.3s; border: none; cursor: pointer; }
        .contact-btn.phone { background: #4caf50; color: white; }
        .contact-btn.phone:hover { background: #43a047; transform: scale(1.05); }
        .contact-btn.web { background: #2196f3; color: white; }
        .contact-btn.web:hover { background: #1e88e5; transform: scale(1.05); }

        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: #4caf50; color: white; padding: 12px 20px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: slideIn 0.3s ease; }
        .toast.blue { background: #1976d2; }
        .toast.purple { background: #9c27b0; }
        .toast.orange { background: #ff5722; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal de Edici√≥n -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Grupo</h3>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="current-hole-display">
                    <div class="label">Hoyo Actual</div>
                    <div class="value" id="modalCurrentHole">-</div>
                </div>
                <div class="form-group">
                    <label>Nombre del Grupo</label>
                    <input type="text" id="editName" placeholder="Nuevo nombre">
                </div>
                <div class="form-group">
                    <label>üé® Color</label>
                    <div class="color-picker-modal" id="editColorPicker"></div>
                </div>

                <!-- SECCI√ìN DE NOTAS -->
                <div class="notes-section">
                    <div class="notes-section-title">
                        <span>üìù</span>
                        <span>Notas / Incidencias</span>
                    </div>
                    <div class="quick-notes">
                        <button class="quick-note-btn warning" onclick="addQuickNote('‚ö†Ô∏è 1¬∫ aviso por lentitud')">‚ö†Ô∏è 1¬∫ Aviso</button>
                        <button class="quick-note-btn danger" onclick="addQuickNote('üö® 2¬∫ aviso por lentitud')">üö® 2¬∫ Aviso</button>
                        <button class="quick-note-btn danger" onclick="addQuickNote('‚è≠Ô∏è Obligado a saltar hoyo')">‚è≠Ô∏è Saltar hoyo</button>
                        <button class="quick-note-btn danger" onclick="addQuickNote('üö´ Sanci√≥n: Circular zona prohibida')">üö´ Zona prohibida</button>
                        <button class="quick-note-btn danger" onclick="addQuickNote('üö´ Sanci√≥n: Buggy en ante-green')">üö´ Ante-green</button>
                        <button class="quick-note-btn warning" onclick="addQuickNote('üì¢ Llamada de atenci√≥n')">üì¢ Atenci√≥n</button>
                        <button class="quick-note-btn success" onclick="addQuickNote('‚úÖ Grupo ejemplar')">‚úÖ Ejemplar</button>
                    </div>
                    <textarea class="notes-textarea" id="editNotes" placeholder="Escribe una nota personalizada..."></textarea>
                    <button class="btn btn-info" style="margin-top: 8px; padding: 8px;" onclick="addCustomNote()">‚ûï A√±adir Nota</button>
                    
                    <div class="notes-history" id="notesHistory">
                        <!-- Las notas se mostrar√°n aqu√≠ -->
                    </div>
                    <button class="clear-notes-btn" id="clearNotesBtn" onclick="clearAllNotes()" style="display: none;">üóëÔ∏è Borrar todas las notas</button>
                </div>

                <div class="skip-info">
                    <div class="skip-info-title"><span>‚è≠Ô∏è</span><span>Saltar Hoyo</span></div>
                    <div class="skip-info-text">Si el grupo va muy lento, puedes hacer que salte al siguiente hoyo.</div>
                    <button class="btn btn-skip" style="margin-top: 10px;" onclick="skipHole()">‚è≠Ô∏è Saltar al Siguiente Hoyo</button>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-primary" onclick="saveEdit()">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div style="font-size: 2.5rem;">‚õ≥</div>
            <div class="header-text">
                <h1>Golf Barcelona</h1>
                <p>Control de Tiempos de Juego</p>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" id="tabPlay" onclick="showTab('play')">üèåÔ∏è Control</button>
            <button class="tab-btn" id="tabSalidas" onclick="showTab('salidas')">üìã Salidas</button>
            <button class="tab-btn" id="tabConfig" onclick="showTab('config')">‚è±Ô∏è Tiempos</button>
            <button class="tab-btn" id="tabRules" onclick="showTab('rules')">üëÆ Marshall</button>
        </div>

        <!-- TAB SALIDAS (NUEVO) -->
        <div id="salidasTab" class="tab-content">
            <div class="panel salidas-panel">
                <div class="salidas-header">
                    <div class="salidas-icon">üìã</div>
                    <div class="salidas-title">Importar Salidas</div>
                    <div class="salidas-subtitle">Pega los datos del Excel con las salidas del d√≠a</div>
                </div>

                <div class="form-group">
                    <label>üìù Pegar datos del Excel</label>
                    <textarea class="paste-area" id="excelData" placeholder="Pega aqu√≠ los datos copiados del Excel...

Formato esperado (separado por tabulaciones):
08:00    Grupo Garc√≠a    4
08:10    Grupo L√≥pez     3
08:20    Grupo Mart√≠nez  4
..."></textarea>
                </div>

                <div class="paste-help">
                    <div class="paste-help-title">üí° C√≥mo importar</div>
                    <div class="paste-help-text">
                        1. Abre tu Excel con las salidas<br>
                        2. Selecciona las celdas con <code>Hora</code>, <code>Nombre</code> y opcionalmente <code>Jugadores</code><br>
                        3. Copia (Ctrl+C) y pega aqu√≠ (Ctrl+V)<br>
                        4. Tambi√©n puedes escribir manualmente: <code>08:00 Grupo Garc√≠a 4</code>
                    </div>
                </div>

                <div class="import-options">
                    <div class="option-box">
                        <h4>üèåÔ∏è Tee de Salida</h4>
                        <div class="tee-selector">
                            <div class="tee-option active" onclick="selectImportTee(this,1)">
                                <div class="tee-number">1</div>
                                <div class="tee-label">Tee 1</div>
                            </div>
                            <div class="tee-option" onclick="selectImportTee(this,10)">
                                <div class="tee-number">10</div>
                                <div class="tee-label">Tee 10</div>
                            </div>
                        </div>
                    </div>

                    <div class="option-box">
                        <h4>üï≥Ô∏è N√∫mero de Hoyos</h4>
                        <div class="holes-selector">
                            <div class="holes-option" onclick="selectImportHoles(this,9)">
                                <div class="holes-number">9</div>
                                <div class="holes-label">Hoyos</div>
                            </div>
                            <div class="holes-option active" onclick="selectImportHoles(this,18)">
                                <div class="holes-number">18</div>
                                <div class="holes-label">Hoyos</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="option-box" style="margin-top: 15px;">
                    <h4>üè∑Ô∏è Tipo de Grupo</h4>
                    <div class="type-selector">
                        <div class="type-option active normal" onclick="selectImportType(this,'normal')">
                            <div class="type-icon">üèåÔ∏è</div>
                            <div class="type-label">Normal</div>
                        </div>
                        <div class="type-option" onclick="selectImportType(this,'tournament')">
                            <div class="type-icon">üèÜ</div>
                            <div class="type-label">Torneo</div>
                        </div>
                        <div class="type-option" onclick="selectImportType(this,'greenmonday')">
                            <div class="type-icon">üèÜ</div>
                            <div class="type-label">Green Monday</div>
                        </div>
                        <div class="type-option" onclick="selectImportType(this,'watch')">
                            <div class="type-icon">‚ö†Ô∏è</div>
                            <div class="type-label">Vigilar</div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-info" style="margin-top: 20px;" onclick="parseExcelData()">üîç Procesar Datos</button>

                <div class="preview-section" id="previewSection" style="display: none;">
                    <div class="preview-title">
                        <h3>üëÄ Vista Previa</h3>
                        <span class="preview-count" id="previewCount">0 grupos</span>
                    </div>
                    <div class="preview-list" id="previewList"></div>
                    <div class="import-actions">
                        <button class="btn btn-secondary" onclick="clearPreview()">üóëÔ∏è Limpiar</button>
                        <button class="btn btn-primary" onclick="importAllGroups()">‚úÖ Importar Todos</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB RULES / MARSHALL -->
        <div id="rulesTab" class="tab-content">
            <div class="panel rules-panel">
                <div class="marshall-header">
                    <div class="marshall-icon">üëÆ</div>
                    <div class="marshall-title">MARSHALL</div>
                    <div class="marshall-subtitle">Reglamento del Club</div>
                </div>
                <div class="notebook">
                    <div class="notebook-binding"></div>
                    <div class="notebook-header">
                        <div class="notebook-header-icon">üìã</div>
                        <div class="notebook-header-text">
                            <h3>Normas de Juego - Golf Barcelona</h3>
                            <p>Por favor, respete las siguientes normas</p>
                        </div>
                    </div>
                    <div class="notebook-content">
                        <div class="rule-section">
                            <div class="rule-section-title"><span class="section-icon">‚è±Ô∏è</span>Ritmo de Juego</div>
                            <div class="rule-item rule-important"><div class="rule-number">1</div><div class="rule-text"><strong>Tiempo m√°ximo:</strong> 4h 28min para 18 hoyos.</div></div>
                            <div class="rule-item"><div class="rule-number">2</div><div class="rule-text">Si pierde m√°s de un hoyo, <strong>deje pasar</strong> al grupo siguiente.</div></div>
                            <div class="rule-item"><div class="rule-number">3</div><div class="rule-text">B√∫squeda de bolas: <strong>3 minutos</strong> m√°ximo.</div></div>
                        </div>
                        <div class="rule-section">
                            <div class="rule-section-title"><span class="section-icon">üèåÔ∏è</span>Tee de Salida</div>
                            <div class="rule-item rule-important"><div class="rule-number">4</div><div class="rule-text">Est√° <strong>totalmente prohibido</strong> jugar fuera de las marcas del tee.</div></div>
                            <div class="rule-item"><div class="rule-number">5</div><div class="rule-text">Presentarse <strong>10 minutos antes</strong> de la hora reservada.</div></div>
                        </div>
                        <div class="rule-section">
                            <div class="rule-section-title"><span class="section-icon">‚ö†Ô∏è</span>Seguridad</div>
                            <div class="rule-item rule-important"><div class="rule-number">6</div><div class="rule-text"><strong>¬°BOLA O FORE!</strong> Grite en voz alta si su bola puede alcanzar a otros.</div></div>
                            <div class="rule-item rule-important"><div class="rule-number">7</div><div class="rule-text">Est√° <strong>totalmente prohibido</strong> acercarse al ante-green con buggys y motos.</div></div>
                            <div class="rule-item"><div class="rule-number">8</div><div class="rule-text">No golpee hasta que el grupo de delante est√© fuera de alcance.</div></div>
                        </div>
                        <div class="rule-section">
                            <div class="rule-section-title"><span class="section-icon">üìå</span>General</div>
                            <div class="rule-item rule-highlight"><div class="rule-number">9</div><div class="rule-text"><strong>M√°ximo 4 jugadores</strong> por grupo.</div></div>
                            <div class="rule-item"><div class="rule-number">10</div><div class="rule-text">Respete las indicaciones del <strong>Marshall</strong>.</div></div>
                        </div>
                    </div>
                    <div class="notebook-footer">
                        <div class="contact-section">
                            <div class="contact-item">
                                <div class="contact-info-left">
                                    <div class="contact-icon">üëÆ</div>
                                    <div class="contact-details">
                                        <div class="contact-label">MARSHALL</div>
                                        <div class="contact-value">(+34) 937 728 802</div>
                                    </div>
                                </div>
                                <a href="tel:+34937728802" class="contact-btn phone">üìû Llamar</a>
                            </div>
                            <div class="contact-item">
                                <div class="contact-info-left">
                                    <div class="contact-icon">üè†</div>
                                    <div class="contact-details">
                                        <div class="contact-label">CASA CLUB</div>
                                        <div class="contact-value">(+34) 937 728 800</div>
                                    </div>
                                </div>
                                <a href="tel:+34937728800" class="contact-btn phone">üìû Llamar</a>
                            </div>
                            <div class="contact-item">
                                <div class="contact-info-left">
                                    <div class="contact-icon">üåê</div>
                                    <div class="contact-details">
                                        <div class="contact-label">P√ÅGINA WEB</div>
                                        <div class="contact-value">golfbarcelona.com</div>
                                    </div>
                                </div>
                                <a href="https://www.golfbarcelona.com" target="_blank" class="contact-btn web">üåç Visitar</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB CONFIG -->
        <div id="configTab" class="tab-content">
            <div class="panel config-panel">
                <div class="config-header">
                    <div><h2 style="border:none;padding:0;margin:0;">‚è±Ô∏è Tiempos por Hoyo</h2></div>
                    <div class="total-time-box"><div class="label">Total</div><div class="value" id="totalTimeDisplay">4h 28min</div></div>
                </div>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="applyPreset('standard')">üìä Est√°ndar</button>
                    <button class="preset-btn" onclick="applyPreset('fast')">üèÉ R√°pido</button>
                    <button class="preset-btn" onclick="applyPreset('slow')">üê¢ Lento</button>
                </div>
                <div class="times-grid">
                    <div class="nine-section"><h3>IDA (1-9)</h3><div id="frontNineTimes"></div><div class="nine-subtotal">Subtotal: <span id="frontNineTotal">0</span> min</div></div>
                    <div class="nine-section"><h3>VUELTA (10-18)</h3><div id="backNineTimes"></div><div class="nine-subtotal">Subtotal: <span id="backNineTotal">0</span> min</div></div>
                </div>
                <button class="save-config-btn" onclick="saveHoleTimes()">üíæ Guardar</button>
            </div>
        </div>

        <!-- TAB PLAY -->
        <div id="playTab" class="tab-content active">
            <div class="main-content">
                <div class="panel">
                    <h2>‚ûï A√±adir Grupo</h2>
                    <div class="current-time-info"><div class="label">Tiempo total</div><div class="value" id="currentTotalTime">4h 28min</div></div>
                    <div class="form-group"><label>Nombre</label><input type="text" id="playerName" placeholder="Ej: Grupo Garc√≠a"></div>
                    <div class="form-group"><label>Hora Salida</label><input type="time" id="startTime" value="08:00"></div>
                    <div class="form-group">
                        <label>Tee de Salida</label>
                        <div class="tee-selector">
                            <div class="tee-option active" onclick="selectTee(this,1)"><div class="tee-number">1</div><div class="tee-label">Tee 1</div></div>
                            <div class="tee-option" onclick="selectTee(this,10)"><div class="tee-number">10</div><div class="tee-label">Tee 10</div></div>
                        </div>
                        <div class="holes-selector">
                            <div class="holes-option" onclick="selectNumHoles(this, 9)"><div class="holes-number">9</div><div class="holes-label">Hoyos</div></div>
                            <div class="holes-option active" onclick="selectNumHoles(this, 18)"><div class="holes-number">18</div><div class="holes-label">Hoyos</div></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>üë• Jugadores y Veh√≠culos</label>
                        <div class="group-config">
                            <div class="config-row has-value" id="rowPlayers"><div class="config-label"><span class="config-icon">üë•</span><div><div class="config-text">Jugadores</div><div class="config-subtext">1-4</div></div></div><div class="quantity-selector"><button class="qty-btn" onclick="changeQty('players',-1)">‚àí</button><div class="qty-value" id="qtyPlayers">4</div><button class="qty-btn" onclick="changeQty('players',1)">+</button></div></div>
                            <div class="config-row" id="rowBuggys"><div class="config-label"><span class="config-icon">üöó</span><div><div class="config-text">Buggys</div><div class="config-subtext">0-2</div></div></div><div class="quantity-selector"><button class="qty-btn" onclick="changeQty('buggys',-1)">‚àí</button><div class="qty-value zero" id="qtyBuggys">0</div><button class="qty-btn" onclick="changeQty('buggys',1)">+</button></div></div>
                            <div class="config-row" id="rowMoto3"><div class="config-label"><span class="config-icon">üõµ</span><div><div class="config-text">Moto 3R</div><div class="config-subtext">0-4</div></div></div><div class="quantity-selector"><button class="qty-btn" onclick="changeQty('moto3',-1)">‚àí</button><div class="qty-value zero" id="qtyMoto3">0</div><button class="qty-btn" onclick="changeQty('moto3',1)">+</button></div></div>
                            <div class="config-row" id="rowMoto4"><div class="config-label"><span class="config-icon">üèçÔ∏è</span><div><div class="config-text">Moto 4R</div><div class="config-subtext">0-4</div></div></div><div class="quantity-selector"><button class="qty-btn" onclick="changeQty('moto4',-1)">‚àí</button><div class="qty-value zero" id="qtyMoto4">0</div><button class="qty-btn" onclick="changeQty('moto4',1)">+</button></div></div>
                            <div class="group-summary" id="groupSummary">üë§üë§üë§üë§</div>
                        </div>
                    </div>
                    <div class="form-group"><label>üé® Color</label><div class="color-picker" id="colorPicker"></div></div>
                    <div class="form-group">
                        <label>üè∑Ô∏è Tipo</label>
                        <div class="group-markers">
                            <div class="marker-box tournament" id="markerTournament" onclick="toggleMarker('tournament')"><div class="marker-icon">üèÜ</div><div class="marker-text">Torneo</div></div>
                            <div class="marker-box greenmonday" id="markerGreenMonday" onclick="toggleMarker('greenmonday')"><div class="marker-icon">üèÜ</div><div class="marker-text">Green Monday</div></div>
                            <div class="marker-box watch" id="markerWatch" onclick="toggleMarker('watch')"><div class="marker-icon">‚ö†Ô∏è</div><div class="marker-text">Vigilar</div></div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addPlayer()">‚ûï A√±adir Grupo</button>
                    <div class="players-list">
                        <h3 style="margin-top:15px;margin-bottom:10px;color:#1a472a;font-size:0.95rem;">üìã Grupos en Campo</h3>
                        <div id="playersContainer"><div class="no-players">No hay grupos</div></div>
                    </div>
                    <button class="btn btn-danger" onclick="clearAllPlayers()">üóëÔ∏è Limpiar</button>
                </div>

                <div class="panel golf-course">
                    <div class="course-title">üèåÔ∏è Golf Barcelona - 18 Hoyos</div>
                    <div class="holes-container">
                        <div class="nine-section-visual" id="frontNineVisual"></div>
                        <div class="nine-section-visual back-nine" id="backNineVisual"></div>
                    </div>
                    <div class="legend" id="legend"></div>
                    <div class="clock-display"><div class="date" id="currentDate"></div><div class="time" id="currentTime"></div></div>
                    <div class="summary-stats">
                        <div class="stat-card"><div class="stat-value" id="totalGroups">0</div><div class="stat-label">Grupos</div></div>
                        <div class="stat-card"><div class="stat-value" id="totalJugadores">0</div><div class="stat-label">Jugadores</div></div>
                        <div class="stat-card"><div class="stat-value" id="delayedCount">0</div><div class="stat-label">Retrasados</div></div>
                        <div class="stat-card tournament"><div class="stat-value" id="tournamentCount">0</div><div class="stat-label">üèÜ Torneo</div></div>
                        <div class="stat-card greenmonday"><div class="stat-value" id="greenMondayCount">0</div><div class="stat-label">üèÜ Green M.</div></div>
                        <div class="stat-card warning"><div class="stat-value" id="watchCount">0</div><div class="stat-label">‚ö†Ô∏è Vigilar</div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const holesData = [
            { n: 1,  par: 5, m: 478, t: 16 }, { n: 2,  par: 3, m: 141, t: 13 }, { n: 3,  par: 4, m: 272, t: 14 },
            { n: 4,  par: 4, m: 353, t: 15 }, { n: 5,  par: 3, m: 150, t: 14 }, { n: 6,  par: 4, m: 379, t: 15 },
            { n: 7,  par: 5, m: 492, t: 16 }, { n: 8,  par: 4, m: 322, t: 15 }, { n: 9,  par: 4, m: 255, t: 15 },
            { n: 10, par: 5, m: 466, t: 16 }, { n: 11, par: 4, m: 311, t: 15 }, { n: 12, par: 4, m: 357, t: 15 },
            { n: 13, par: 5, m: 483, t: 16 }, { n: 14, par: 3, m: 127, t: 14 }, { n: 15, par: 4, m: 317, t: 15 },
            { n: 16, par: 3, m: 139, t: 13 }, { n: 17, par: 4, m: 361, t: 16 }, { n: 18, par: 4, m: 321, t: 15 }
        ];

        const colors = ['#e53935','#1e88e5','#fdd835','#7b1fa2','#fb8c00','#00897b','#d81b60','#5e35b1','#43a047','#00acc1','#8e24aa','#f4511e'];
        const presets = {
            standard: {1:16,2:13,3:14,4:15,5:14,6:15,7:16,8:15,9:15,10:16,11:15,12:15,13:16,14:14,15:15,16:13,17:16,18:15},
            fast: {1:13,2:10,3:11,4:12,5:11,6:12,7:13,8:12,9:12,10:13,11:12,12:12,13:13,14:11,15:12,16:10,17:13,18:12},
            slow: {1:19,2:16,3:17,4:18,5:17,6:18,7:19,8:18,9:18,10:19,11:18,12:18,13:19,14:17,15:18,16:16,17:19,18:18}
        };
        const limits = {players:{min:1,max:4},buggys:{min:0,max:2},moto3:{min:0,max:4},moto4:{min:0,max:4}};
        const GREEN_MONDAY_EXTRA = 10;

        let holeTimes = {}, players = [], selectedTee = 1, selectedNumHoles = 18, selectedColor = colors[0];
        let watchGroup = false, tournamentGroup = false, greenMondayGroup = false;
        let qty = {players:4,buggys:0,moto3:0,moto4:0};
        let editingPlayerId = null, editSelectedColor = null, draggedItem = null;

        // Variables para importaci√≥n
        let importTee = 1, importHoles = 18, importType = 'normal';
        let parsedGroups = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadData(); initColors(); renderTimesConfig(); render(); updateClock();
            setInterval(updateClock, 1000);
        });

        function loadData() {
            try {
                holeTimes = JSON.parse(localStorage.getItem('golf_times')) || {...presets.standard};
                players = JSON.parse(localStorage.getItem('golf_players')) || [];
                // Asegurar que todos los jugadores tengan el array de notas
                players.forEach(p => {
                    if (!p.notes) p.notes = [];
                });
            } catch(e) { holeTimes = {...presets.standard}; players = []; }
        }

        function saveData() {
            localStorage.setItem('golf_times', JSON.stringify(holeTimes));
            localStorage.setItem('golf_players', JSON.stringify(players));
        }

        function showTab(tab) {
            ['play','salidas','config','rules'].forEach(t => {
                document.getElementById(t+'Tab')?.classList.remove('active');
                document.getElementById('tab'+t.charAt(0).toUpperCase()+t.slice(1))?.classList.remove('active');
            });
            document.getElementById(tab+'Tab')?.classList.add('active');
            document.getElementById('tab'+tab.charAt(0).toUpperCase()+tab.slice(1))?.classList.add('active');
        }

        function initColors() {
            document.getElementById('colorPicker').innerHTML = colors.map((c,i) => 
                '<div class="color-option '+(i===0?'selected':'')+'" style="background:'+c+'" onclick="selectColor(this,\''+c+'\')"></div>'
            ).join('');
        }

        function selectColor(el, c) {
            document.querySelectorAll('#colorPicker .color-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected'); selectedColor = c;
        }

        function selectTee(el, t) {
            document.querySelectorAll('.main-content .tee-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active'); selectedTee = t;
        }

        function selectNumHoles(el, num) {
            document.querySelectorAll('.main-content .holes-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active'); selectedNumHoles = num;
        }

        function changeQty(type, delta) {
            const nv = qty[type] + delta;
            if (nv >= limits[type].min && nv <= limits[type].max) { qty[type] = nv; updateQtyDisplay(); }
        }

        function updateQtyDisplay() {
            ['players','buggys','moto3','moto4'].forEach(t => {
                const el = document.getElementById('qty'+t.charAt(0).toUpperCase()+t.slice(1));
                const row = document.getElementById('row'+t.charAt(0).toUpperCase()+t.slice(1));
                if (el && row) { el.textContent = qty[t]; el.classList.toggle('zero', qty[t] === 0); row.classList.toggle('has-value', qty[t] > 0); }
            });
            let s = '';
            for(let i=0;i<qty.players;i++) s+='üë§';
            if(qty.buggys+qty.moto3+qty.moto4>0) s+=' ';
            for(let i=0;i<qty.buggys;i++) s+='üöó';
            for(let i=0;i<qty.moto3;i++) s+='üõµ';
            for(let i=0;i<qty.moto4;i++) s+='üèçÔ∏è';
            document.getElementById('groupSummary').textContent = s || 'üë§';
        }

        function toggleMarker(type) {
            if(type==='watch') { watchGroup = !watchGroup; document.getElementById('markerWatch').classList.toggle('active', watchGroup); }
            else if(type==='tournament') { tournamentGroup = !tournamentGroup; document.getElementById('markerTournament').classList.toggle('active', tournamentGroup); }
            else if(type==='greenmonday') { greenMondayGroup = !greenMondayGroup; document.getElementById('markerGreenMonday').classList.toggle('active', greenMondayGroup); }
        }

        function resetForm() {
            qty = {players:4,buggys:0,moto3:0,moto4:0}; updateQtyDisplay();
            watchGroup = tournamentGroup = greenMondayGroup = false;
            document.querySelectorAll('.marker-box').forEach(m => m.classList.remove('active'));
            selectedNumHoles = 18;
            document.querySelectorAll('.main-content .holes-option').forEach((o, i) => o.classList.toggle('active', i === 1));
        }

        function getNextColor() {
            const used = players.map(p => p.color);
            return colors.find(c => !used.includes(c)) || colors[Math.floor(Math.random() * colors.length)];
        }

        function addPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const time = document.getElementById('startTime').value;
            if(!name) { alert('Introduce un nombre'); return; }

            players.push({
                id: Date.now(), name, startTime: time, startTee: selectedTee, numHoles: selectedNumHoles,
                color: selectedColor, watchGroup, tournamentGroup, greenMondayGroup,
                numPlayers: qty.players, numBuggys: qty.buggys, numMoto3: qty.moto3, numMoto4: qty.moto4,
                skippedHoles: 0,
                notes: []
            });

            saveData(); render();
            document.getElementById('playerName').value = '';
            resetForm();
            selectedColor = getNextColor();
            initColors();
            document.querySelectorAll('#colorPicker .color-option').forEach(o => o.classList.toggle('selected', o.style.background === selectedColor));
            showToast('‚úÖ '+name+' a√±adido', '');
        }

        function deletePlayer(id) { players = players.filter(p => p.id !== id); saveData(); render(); }
        function clearAllPlayers() { if(confirm('¬øEliminar todos?')) { players = []; saveData(); render(); } }

        function openEditModal(id) {
            const player = players.find(p => p.id === id);
            if (!player) return;
            editingPlayerId = id;
            editSelectedColor = player.color;
            document.getElementById('editName').value = player.name;
            const exp = calcHole(player);
            document.getElementById('modalCurrentHole').textContent = exp.hole > 0 && exp.hole <= 18 ? exp.hole : '-';
            document.getElementById('editColorPicker').innerHTML = colors.map(c => 
                '<div class="color-option '+(c === player.color ? 'selected' : '')+'" style="background:'+c+'" onclick="selectEditColor(this,\''+c+'\')"></div>'
            ).join('');
            
            // Limpiar textarea de notas
            document.getElementById('editNotes').value = '';
            
            // Renderizar historial de notas
            renderNotesHistory(player);
            
            document.getElementById('editModal').classList.add('active');
        }

        function closeModal() { document.getElementById('editModal').classList.remove('active'); editingPlayerId = null; }

        function selectEditColor(el, c) {
            document.querySelectorAll('#editColorPicker .color-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            editSelectedColor = c;
        }

        // ===== FUNCIONES DE NOTAS =====
        function addQuickNote(noteText) {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player) return;
            
            if (!player.notes) player.notes = [];
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            player.notes.push({
                id: Date.now(),
                text: noteText,
                time: timeStr
            });
            
            saveData();
            renderNotesHistory(player);
            render();
            showToast('üìù Nota a√±adida', 'orange');
        }

        function addCustomNote() {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player) return;
            
            const noteText = document.getElementById('editNotes').value.trim();
            if (!noteText) {
                showToast('‚ö†Ô∏è Escribe una nota', 'orange');
                return;
            }
            
            if (!player.notes) player.notes = [];
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            player.notes.push({
                id: Date.now(),
                text: noteText,
                time: timeStr
            });
            
            document.getElementById('editNotes').value = '';
            saveData();
            renderNotesHistory(player);
            render();
            showToast('üìù Nota a√±adida', 'orange');
        }

        function deleteNote(noteId) {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player || !player.notes) return;
            
            player.notes = player.notes.filter(n => n.id !== noteId);
            saveData();
            renderNotesHistory(player);
            render();
        }

        function clearAllNotes() {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player) return;
            
            if (confirm('¬øBorrar todas las notas de este grupo?')) {
                player.notes = [];
                saveData();
                renderNotesHistory(player);
                render();
                showToast('üóëÔ∏è Notas borradas', '');
            }
        }

        function renderNotesHistory(player) {
            const container = document.getElementById('notesHistory');
            const clearBtn = document.getElementById('clearNotesBtn');
            
            if (!player.notes || player.notes.length === 0) {
                container.innerHTML = '<div style="text-align:center;color:#999;font-size:0.8rem;padding:10px;">Sin notas</div>';
                clearBtn.style.display = 'none';
                return;
            }
            
            clearBtn.style.display = 'block';
            
            // Mostrar notas en orden inverso (m√°s reciente primero)
            const sortedNotes = [...player.notes].reverse();
            
            container.innerHTML = sortedNotes.map(note => `
                <div class="note-item">
                    <span class="note-time">${note.time}</span>
                    <span class="note-text">${note.text}</span>
                    <button class="note-delete" onclick="deleteNote(${note.id})">‚úï</button>
                </div>
            `).join('');
        }

        function saveEdit() {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player) return;
            const newName = document.getElementById('editName').value.trim();
            if (newName) player.name = newName;
            if (editSelectedColor) player.color = editSelectedColor;
            saveData(); render(); closeModal();
            showToast('‚úÖ Grupo actualizado', '');
        }

        function skipHole() {
            if (!editingPlayerId) return;
            const player = players.find(p => p.id === editingPlayerId);
            if (!player) return;
            player.skippedHoles = (player.skippedHoles || 0) + 1;
            
            // A√±adir nota autom√°tica
            if (!player.notes) player.notes = [];
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            player.notes.push({
                id: Date.now(),
                text: '‚è≠Ô∏è Salt√≥ hoyo #' + player.skippedHoles,
                time: timeStr
            });
            
            saveData(); render(); closeModal();
            showToast('‚è≠Ô∏è Grupo salt√≥ hoyo', 'purple');
        }

        function quickSkip(id) {
            const player = players.find(p => p.id === id);
            if (!player) return;
            player.skippedHoles = (player.skippedHoles || 0) + 1;
            
            // A√±adir nota autom√°tica
            if (!player.notes) player.notes = [];
            const now = new Date();
            const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            player.notes.push({
                id: Date.now(),
                text: '‚è≠Ô∏è Salt√≥ hoyo #' + player.skippedHoles,
                time: timeStr
            });
            
            saveData(); render();
            showToast('‚è≠Ô∏è Salt√≥ hoyo', 'purple');
        }

        function handleDragStart(e, id) { draggedItem = id; e.target.classList.add('dragging'); }
        function handleDragEnd(e) { e.target.classList.remove('dragging'); document.querySelectorAll('.player-card').forEach(c => c.classList.remove('drag-over')); draggedItem = null; }
        function handleDragOver(e) { e.preventDefault(); }
        function handleDragEnter(e, id) { if (draggedItem !== id) e.target.closest('.player-card')?.classList.add('drag-over'); }
        function handleDragLeave(e) { e.target.closest('.player-card')?.classList.remove('drag-over'); }
        function handleDrop(e, targetId) {
            e.preventDefault();
            if (draggedItem === targetId) return;
            const di = players.findIndex(p => p.id === draggedItem);
            const ti = players.findIndex(p => p.id === targetId);
            if (di === -1 || ti === -1) return;
            const [removed] = players.splice(di, 1);
            players.splice(ti, 0, removed);
            saveData(); render();
        }

        // ===== IMPORTACI√ìN DE EXCEL =====
        function selectImportTee(el, t) {
            document.querySelectorAll('.salidas-panel .tee-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active');
            importTee = t;
        }

        function selectImportHoles(el, num) {
            document.querySelectorAll('.salidas-panel .holes-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active');
            importHoles = num;
        }

        function selectImportType(el, type) {
            document.querySelectorAll('.type-option').forEach(o => o.classList.remove('active', 'normal', 'tournament', 'greenmonday', 'watch'));
            el.classList.add('active', type);
            importType = type;
        }

        function parseExcelData() {
            const data = document.getElementById('excelData').value.trim();
            if (!data) { alert('Pega los datos del Excel primero'); return; }

            parsedGroups = [];
            const lines = data.split('\n');

            lines.forEach((line, index) => {
                if (!line.trim()) return;

                // Separar por tabulaci√≥n o m√∫ltiples espacios
                const parts = line.split(/\t+|\s{2,}/).map(p => p.trim()).filter(p => p);
                
                if (parts.length < 2) {
                    // Intentar separar por espacio simple si tiene formato "08:00 Nombre"
                    const match = line.match(/^(\d{1,2}:\d{2})\s+(.+?)(?:\s+(\d+))?$/);
                    if (match) {
                        parts[0] = match[1];
                        parts[1] = match[2];
                        if (match[3]) parts[2] = match[3];
                    }
                }

                if (parts.length >= 2) {
                    let time = parts[0];
                    let name = parts[1];
                    let numPlayers = parts[2] ? parseInt(parts[2]) : 4;

                    // Validar formato de hora
                    if (!/^\d{1,2}:\d{2}$/.test(time)) return;

                    // Formatear hora a HH:MM
                    const [h, m] = time.split(':');
                    time = h.padStart(2, '0') + ':' + m;

                    if (numPlayers < 1 || numPlayers > 4 || isNaN(numPlayers)) numPlayers = 4;

                    parsedGroups.push({
                        time,
                        name,
                        numPlayers,
                        color: getNextColorForImport(parsedGroups.length)
                    });
                }
            });

            // Ordenar por hora
            parsedGroups.sort((a, b) => a.time.localeCompare(b.time));

            renderPreview();
        }

        function getNextColorForImport(index) {
            const usedColors = players.map(p => p.color);
            const availableColors = colors.filter(c => !usedColors.includes(c));
            return availableColors[index % availableColors.length] || colors[index % colors.length];
        }

        function renderPreview() {
            const section = document.getElementById('previewSection');
            const list = document.getElementById('previewList');
            const count = document.getElementById('previewCount');

            if (parsedGroups.length === 0) {
                section.style.display = 'none';
                showToast('‚ö†Ô∏è No se encontraron grupos v√°lidos', '');
                return;
            }

            section.style.display = 'block';
            count.textContent = parsedGroups.length + ' grupos';

            let typeClass = '';
            if (importType === 'tournament') typeClass = 'tournament';
            else if (importType === 'greenmonday') typeClass = 'greenmonday';
            else if (importType === 'watch') typeClass = 'watch';

            list.innerHTML = parsedGroups.map((g, i) => `
                <div class="preview-item ${typeClass}">
                    <div class="preview-time">${g.time}</div>
                    <div class="preview-name">${g.name}</div>
                    <div class="preview-players">üë§ ${g.numPlayers}</div>
                    <button class="preview-remove" onclick="removeFromPreview(${i})">‚úï</button>
                </div>
            `).join('');

            showToast('‚úÖ ' + parsedGroups.length + ' grupos detectados', '');
        }

        function removeFromPreview(index) {
            parsedGroups.splice(index, 1);
            renderPreview();
        }

        function clearPreview() {
            parsedGroups = [];
            document.getElementById('excelData').value = '';
            document.getElementById('previewSection').style.display = 'none';
        }

        function importAllGroups() {
            if (parsedGroups.length === 0) { alert('No hay grupos para importar'); return; }

            let colorIndex = 0;
            const usedColors = players.map(p => p.color);

            parsedGroups.forEach(g => {
                // Encontrar color disponible
                let color = colors.find(c => !usedColors.includes(c));
                if (!color) color = colors[colorIndex % colors.length];
                usedColors.push(color);
                colorIndex++;

                players.push({
                    id: Date.now() + Math.random(),
                    name: g.name,
                    startTime: g.time,
                    startTee: importTee,
                    numHoles: importHoles,
                    color: color,
                    watchGroup: importType === 'watch',
                    tournamentGroup: importType === 'tournament',
                    greenMondayGroup: importType === 'greenmonday',
                    numPlayers: g.numPlayers,
                    numBuggys: 0,
                    numMoto3: 0,
                    numMoto4: 0,
                    skippedHoles: 0,
                    notes: []
                });
            });

            // Ordenar todos por hora de salida
            players.sort((a, b) => a.startTime.localeCompare(b.startTime));

            saveData();
            render();
            clearPreview();
            showTab('play');
            showToast('‚úÖ ' + parsedGroups.length + ' grupos importados', '');
            parsedGroups = [];
        }

        // ===== C√ÅLCULOS =====
        function getHoleTime(holeNum, isGreenMonday) {
            let time = holeTimes[holeNum] || holesData[holeNum-1].t;
            if (holeNum === 16 && isGreenMonday) time += GREEN_MONDAY_EXTRA;
            return time;
        }

        function calcHole(p) {
            const now = new Date();
            const [h,m] = p.startTime.split(':').map(Number);
            const start = new Date(); start.setHours(h,m,0,0);
            const skippedTime = (p.skippedHoles || 0) * 15;
            const elapsed = ((now - start) / 60000) + skippedTime;
            if(elapsed < 0) return {hole:0, status:'pending', diff:Math.round(-elapsed)};
            const numHoles = p.numHoles || 18;
            const isGreenMonday = p.greenMondayGroup || false;
            let order = p.startTee === 1 
                ? (numHoles === 9 ? [1,2,3,4,5,6,7,8,9] : [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])
                : (numHoles === 9 ? [10,11,12,13,14,15,16,17,18] : [10,11,12,13,14,15,16,17,18,1,2,3,4,5,6,7,8,9]);
            let total = 0;
            for(const ho of order) total += getHoleTime(ho, isGreenMonday);
            if(elapsed >= total) return {hole:19, status:'finished', diff:0};
            let acc = 0, curr = order[0], into = 0, ht = 0;
            for(const ho of order) {
                ht = getHoleTime(ho, isGreenMonday);
                if(acc + ht > elapsed) { curr = ho; into = elapsed - acc; break; }
                acc += ht;
            }
            let status = 'ontime';
            if(into > ht * 0.8) status = 'delayed';
            else if(into < ht * 0.3) status = 'ahead';
            return {hole:curr, status, diff:Math.round(into), holeTime:ht};
        }

        function getDetails(p) {
            let parts = [(p.numPlayers||1)+' jug.'];
            if(p.numBuggys>0) parts.push(p.numBuggys+' buggy');
            if(p.numMoto3>0) parts.push(p.numMoto3+' moto3R');
            if(p.numMoto4>0) parts.push(p.numMoto4+' moto4R');
            return parts.join(' ‚Ä¢ ');
        }

        function render() { renderPlayers(); renderCourse(); }

        function renderPlayers() {
            const c = document.getElementById('playersContainer');
            if(players.length === 0) { c.innerHTML = '<div class="no-players">No hay grupos</div>'; updateStats(); return; }
            let html = '';
            players.forEach(p => {
                const exp = calcHole(p);
                let sc = '', st = '', bc = '';
                if(exp.status==='pending') { st='Sale en '+exp.diff+' min'; bc='status-ontime'; }
                else if(exp.status==='finished') { st='Finalizado'; bc='status-ahead'; }
                else if(exp.status==='delayed') { sc='delayed'; st=exp.diff+'/'+exp.holeTime+' min'; bc='status-delayed'; }
                else if(exp.status==='ahead') { st='Adelantado'; bc='status-ahead'; }
                else { st='En tiempo'; bc='status-ontime'; }
                if(p.watchGroup) sc += ' watch-group';
                if(p.tournamentGroup) sc += ' tournament-group';
                if(p.greenMondayGroup) sc += ' greenmonday-group';
                if(p.skippedHoles > 0) sc += ' skipped-group';
                const numHoles = p.numHoles || 18;
                html += `<div class="player-card ${sc}" draggable="true" ondragstart="handleDragStart(event,${p.id})" ondragend="handleDragEnd(event)" ondragover="handleDragOver(event)" ondragenter="handleDragEnter(event,${p.id})" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event,${p.id})">
                    <div class="player-actions">
                        <button class="action-btn" onclick="openEditModal(${p.id})" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn" onclick="quickSkip(${p.id})" title="Saltar">‚è≠Ô∏è</button>
                        <button class="action-btn" onclick="deletePlayer(${p.id})" title="Eliminar">‚úï</button>
                    </div>
                    <div class="player-header">
                        <div class="player-color" style="background:${p.color}"></div>
                        <div class="player-name">${p.name}</div>
                        ${numHoles===9?'<span class="badge nine-holes">9H</span>':''}
                        ${p.skippedHoles>0?'<span class="badge skipped">‚è≠Ô∏è'+p.skippedHoles+'</span>':''}
                        ${p.tournamentGroup?'<span class="badge tournament">üèÜ</span>':''}
                        ${p.greenMondayGroup?'<span class="badge greenmonday">üèÜGM</span>':''}
                        ${p.watchGroup?'<span class="badge watch">‚ö†Ô∏è</span>':''}
                    </div>
                    <div class="player-info">üïê ${p.startTime} ‚Ä¢ Tee ${p.startTee} ‚Ä¢ üèåÔ∏è ${numHoles}H${p.greenMondayGroup?' ‚Ä¢ <span style="color:#4caf50">+10min H16</span>':''}</div>
                    <div class="player-details">${getDetails(p)}</div>
                    <div class="player-footer">
                        ${exp.hole>0&&exp.hole<=18?'<div>Hoyo: <span class="expected-hole">'+exp.hole+'</span></div>':'<div></div>'}
                        <span class="player-status ${bc}">${st}</span>
                    </div>
                </div>`;
            });
            c.innerHTML = html;
            updateStats();
        }

        function updateStats() {
            let g=0,j=0,d=0,w=0,t=0,gm=0;
            players.forEach(p => {
                const exp = calcHole(p);
                if(exp.status!=='pending'&&exp.status!=='finished'){g++;if(exp.status==='delayed')d++;}
                j += p.numPlayers||1;
                if(p.watchGroup)w++;
                if(p.tournamentGroup)t++;
                if(p.greenMondayGroup)gm++;
            });
            document.getElementById('totalGroups').textContent = g;
            document.getElementById('totalJugadores').textContent = j;
            document.getElementById('delayedCount').textContent = d;
            document.getElementById('watchCount').textContent = w;
            document.getElementById('tournamentCount').textContent = t;
            document.getElementById('greenMondayCount').textContent = gm;
        }

        function renderCourse() {
            const front = document.getElementById('frontNineVisual');
            const back = document.getElementById('backNineVisual');
            const byHole = {};
            players.forEach(p => { const exp = calcHole(p); if(exp.hole>0&&exp.hole<=18){if(!byHole[exp.hole])byHole[exp.hole]=[];byHole[exp.hole].push(p);} });
            let fh = '<div class="nine-title">IDA (1-9)</div>';
            let bh = '<div class="nine-title">VUELTA (10-18)</div>';
            holesData.forEach(h => {
                const pls = byHole[h.n]||[];
                const hasW = pls.some(p=>p.watchGroup);
                const hasT = pls.some(p=>p.tournamentGroup);
                const hasGM = pls.some(p=>p.greenMondayGroup);
                const hasS = pls.some(p=>p.skippedHoles>0);
                const hasC = pls.length>0;
                let hc = '';
                if(hasS)hc='skipped-hole';else if(hasW)hc='watch-hole';else if(hasGM)hc='greenmonday-hole';else if(hasT)hc='tournament-hole';else if(hasC)hc='current';
                let ht = holeTimes[h.n]||h.t;
                let td = ht+' min';
                if(h.n===16&&hasGM)td=ht+'+10';
                let holeHtml = `<div class="hole ${hc}"><div class="hole-number">${h.n}</div><div class="hole-info">Par ${h.par} ‚Ä¢ ${h.m}m<br>‚è±Ô∏è ${td}</div>`;
                if(pls.length>0){holeHtml+='<div class="player-markers">'+pls.map(p=>`<div class="player-dot" style="background:${p.color}"></div>`).join('')+'</div>';}
                holeHtml+='</div>';
                if(h.n<=9)fh+=holeHtml;else bh+=holeHtml;
            });
            front.innerHTML = fh;
            back.innerHTML = bh;
            renderLegend();
        }

        function renderLegend() {
            const leg = document.getElementById('legend');
            if(players.length === 0) { leg.innerHTML = ''; return; }
            leg.innerHTML = players.map(p => {
                const exp = calcHole(p);
                const txt = exp.status==='pending' ? 'Pend.' : (exp.status==='finished' ? 'Fin' : 'H'+exp.hole);
                let ic = '';
                if(p.skippedHoles > 0) ic = 'skipped';
                else if(p.greenMondayGroup) ic = 'greenmonday';
                else if(p.tournamentGroup) ic = 'tournament';
                else if(p.watchGroup) ic = 'watch';
                const displayName = p.name.split(' (')[0];
                return '<div class="legend-item '+ic+'"><div class="legend-dot" style="background:'+p.color+'"></div><span>'+displayName+' - '+txt+'</span></div>';
            }).join('');
        }

        function renderTimesConfig() {
            const f = document.getElementById('frontNineTimes');
            const b = document.getElementById('backNineTimes');
            let fh = '', bh = '';
            holesData.forEach(h => {
                const t = holeTimes[h.n] || h.t;
                const html = '<div class="hole-time-row"><div class="hole-badge">'+h.n+'</div><div class="hole-details"><div class="par-info">Par '+h.par+'</div><div class="meters-info">'+h.m+'m</div></div><div class="time-input-wrapper"><input type="number" id="ht'+h.n+'" value="'+t+'" min="5" max="30" onchange="updateTotals()"><span>min</span></div></div>';
                if(h.n <= 9) fh += html; else bh += html;
            });
            f.innerHTML = fh; b.innerHTML = bh;
            updateTotals();
        }

        function updateTotals() {
            let ft = 0, bt = 0;
            for(let i=1; i<=18; i++) {
                const inp = document.getElementById('ht'+i);
                const v = inp ? parseInt(inp.value) || holesData[i-1].t : holeTimes[i] || holesData[i-1].t;
                if(i <= 9) ft += v; else bt += v;
            }
            document.getElementById('frontNineTotal').textContent = ft;
            document.getElementById('backNineTotal').textContent = bt;
            const tot = ft + bt;
            document.getElementById('totalTimeDisplay').textContent = Math.floor(tot/60)+'h '+(tot%60)+'min';
            document.getElementById('currentTotalTime').textContent = Math.floor(tot/60)+'h '+(tot%60)+'min';
        }

        function saveHoleTimes() {
            for(let i=1; i<=18; i++) {
                const inp = document.getElementById('ht'+i);
                if(inp) holeTimes[i] = parseInt(inp.value) || holesData[i-1].t;
            }
            saveData(); render();
            showToast('‚úÖ Tiempos guardados', '');
        }

        function applyPreset(name) { holeTimes = {...presets[name]}; renderTimesConfig(); showToast('üìä Preset aplicado', ''); }

        function updateClock() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('es-ES');
            document.getElementById('currentDate').textContent = now.toLocaleDateString('es-ES', {weekday:'long', day:'numeric', month:'short'});
            render();
        }

        function showToast(msg, colorClass) {
            const c = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = 'toast' + (colorClass ? ' '+colorClass : '');
            t.textContent = msg;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>